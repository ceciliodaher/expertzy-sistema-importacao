<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETL Validator - Sistema de Validação de Dados</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Expertzy Brand System -->
    <link href="../../shared/styles/expertzy-brand.css" rel="stylesheet">
    <link href="../styles/etl-theme.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../styles/etl-validator-styles.css" rel="stylesheet">
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="text-center">
            <div class="spinner"></div>
            <div class="text-white mt-3">Executando validações ETL...</div>
        </div>
    </div>

    <!-- Professional Navigation -->
    <nav class="navbar navbar-expand-lg expertzy-navbar fixed-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="../../../index.html">
                <img src="../../../public/images/expertzy-it.png" alt="Expertzy - Inteligência Tributária" class="expertzy-complete-logo" onerror="this.onerror=null; this.src='../../../public/images/expertzy-it.png';">
            </a>

            <!-- Breadcrumb Navigation -->
            <div class="navbar-nav mx-auto">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item">
                            <a href="../../../index.html" class="text-white">
                                <i class="bi bi-house"></i> Início
                            </a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="../../../di-interface.html" class="text-white">
                                <i class="bi bi-file-earmark-text"></i> Processamento DI
                            </a>
                        </li>
                        <li class="breadcrumb-item active text-white" aria-current="page">
                            <i class="bi bi-shield-check"></i> ETL Validator
                        </li>
                    </ol>
                </nav>
            </div>

            <!-- Status Indicator -->
            <div class="d-flex align-items-center text-white">
                <span class="etl-status-indicator" id="etlStatusIndicator">
                    <i class="bi bi-circle-fill text-warning me-1"></i>
                    <span id="etlStatusText">Aguardando</span>
                </span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-5 pt-4">
        <div class="row">
            <!-- Main Dashboard -->
            <div class="col-xl-9 col-lg-8">
                <!-- Header Section -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="expertzy-title mb-1">
                            <i class="bi bi-shield-check etl-primary me-2"></i>
                            ETL Validator Dashboard
                        </h2>
                        <p class="text-muted mb-0">Monitoramento de qualidade de dados em tempo real</p>
                    </div>
                    <div class="d-flex align-items-center gap-3">
                        <span class="badge bg-light text-dark px-3 py-2">
                            <i class="bi bi-clock me-1"></i>
                            Última atualização: <span id="lastUpdate">--:--</span>
                        </span>
                        <button class="btn btn-etl-primary btn-sm" id="refreshBtn">
                            <i class="bi bi-arrow-clockwise me-1"></i>
                            Atualizar
                        </button>
                    </div>
                </div>

                <!-- Quality Overview Cards -->
                <div class="row mb-4">
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card etl-card h-100">
                            <div class="card-body text-center">
                                <div class="etl-quality-circle mb-3" id="overallQuality">
                                    <div class="circle-progress" data-percentage="0">
                                        <div class="circle-inner">
                                            <span class="percentage">--</span>
                                            <small class="grade">--</small>
                                        </div>
                                    </div>
                                </div>
                                <h6 class="card-title mb-0">Qualidade Geral</h6>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card etl-card h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <i class="bi bi-check-circle-fill etl-success fs-2"></i>
                                    </div>
                                    <div class="text-end">
                                        <h4 class="mb-0" id="completenessValue">--</h4>
                                        <small class="text-muted">Completude</small>
                                    </div>
                                </div>
                                <div class="progress mt-2" style="height: 4px;">
                                    <div class="progress-bar bg-success" id="completenessBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card etl-card h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <i class="bi bi-balance-scale etl-info fs-2"></i>
                                    </div>
                                    <div class="text-end">
                                        <h4 class="mb-0" id="consistencyValue">--</h4>
                                        <small class="text-muted">Consistência</small>
                                    </div>
                                </div>
                                <div class="progress mt-2" style="height: 4px;">
                                    <div class="progress-bar bg-info" id="consistencyBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card etl-card h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <i class="bi bi-bullseye etl-warning fs-2"></i>
                                    </div>
                                    <div class="text-end">
                                        <h4 class="mb-0" id="accuracyValue">--</h4>
                                        <small class="text-muted">Precisão</small>
                                    </div>
                                </div>
                                <div class="progress mt-2" style="height: 4px;">
                                    <div class="progress-bar bg-warning" id="accuracyBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ETL Pipeline Status -->
                <div class="card etl-card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-diagram-3 me-2"></i>
                            Pipeline ETL
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="etl-pipeline">
                            <div class="pipeline-step" data-step="extraction">
                                <div class="step-icon">
                                    <i class="bi bi-download"></i>
                                </div>
                                <div class="step-content">
                                    <h6>Extração</h6>
                                    <div class="step-status" id="extractionStatus">
                                        <span class="badge bg-secondary">Pendente</span>
                                    </div>
                                    <small class="text-muted" id="extractionDuration">--ms</small>
                                </div>
                                <div class="step-connector"></div>
                            </div>
                            
                            <div class="pipeline-step" data-step="transformation">
                                <div class="step-icon">
                                    <i class="bi bi-gear-fill"></i>
                                </div>
                                <div class="step-content">
                                    <h6>Transformação</h6>
                                    <div class="step-status" id="transformationStatus">
                                        <span class="badge bg-secondary">Pendente</span>
                                    </div>
                                    <small class="text-muted" id="transformationDuration">--ms</small>
                                </div>
                                <div class="step-connector"></div>
                            </div>
                            
                            <div class="pipeline-step" data-step="loading">
                                <div class="step-icon">
                                    <i class="bi bi-database-fill"></i>
                                </div>
                                <div class="step-content">
                                    <h6>Carregamento</h6>
                                    <div class="step-status" id="loadingStatus">
                                        <span class="badge bg-secondary">Pendente</span>
                                    </div>
                                    <small class="text-muted" id="loadingDuration">--ms</small>
                                </div>
                                <div class="step-connector"></div>
                            </div>
                            
                            <div class="pipeline-step" data-step="quality">
                                <div class="step-icon">
                                    <i class="bi bi-shield-check"></i>
                                </div>
                                <div class="step-content">
                                    <h6>Qualidade</h6>
                                    <div class="step-status" id="qualityStatus">
                                        <span class="badge bg-secondary">Pendente</span>
                                    </div>
                                    <small class="text-muted" id="qualityDuration">--ms</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alerts and Issues -->
                <div class="card etl-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            Alertas e Problemas
                        </h5>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-danger" id="alertCount">0</span>
                            <button class="btn btn-sm btn-outline-secondary" id="clearAlertsBtn">
                                <i class="bi bi-trash3"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="alertsContainer" class="alerts-container">
                            <div class="text-center py-4 text-muted">
                                <i class="bi bi-check-circle fs-1 mb-2 d-block"></i>
                                Nenhum alerta no momento
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar Controls -->
            <div class="col-xl-3 col-lg-4">
                <div class="card etl-card sticky-top" style="top: 100px;">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-sliders me-2"></i>
                            Controles ETL
                        </h6>
                    </div>
                    <div class="card-body">
                        <!-- Validation Controls -->
                        <div class="mb-4">
                            <h6 class="text-muted mb-3">Validações</h6>
                            <div class="d-grid gap-2">
                                <button class="btn btn-etl-primary" id="runValidationBtn">
                                    <i class="bi bi-play-circle me-1"></i>
                                    Executar Validação
                                </button>
                                <button class="btn btn-outline-danger" id="stopValidationBtn" disabled>
                                    <i class="bi bi-stop-circle me-1"></i>
                                    Parar Validação
                                </button>
                            </div>
                        </div>

                        <!-- Configuration -->
                        <div class="mb-4">
                            <h6 class="text-muted mb-3">Configurações</h6>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="autoRefreshSwitch" checked>
                                <label class="form-check-label" for="autoRefreshSwitch">
                                    Auto-refresh
                                </label>
                            </div>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="soundAlertsSwitch">
                                <label class="form-check-label" for="soundAlertsSwitch">
                                    Alertas sonoros
                                </label>
                            </div>
                        </div>

                        <!-- Quality Thresholds -->
                        <div class="mb-4">
                            <h6 class="text-muted mb-3">Limites de Qualidade</h6>
                            <div class="mb-3">
                                <label class="form-label small">Qualidade Mínima: <span id="qualityThresholdValue">70%</span></label>
                                <input type="range" class="form-range" id="qualityThreshold" min="50" max="95" value="70">
                            </div>
                        </div>

                        <!-- Export Options -->
                        <div>
                            <h6 class="text-muted mb-3">Relatórios</h6>
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-primary btn-sm" id="exportPdfBtn">
                                    <i class="bi bi-file-earmark-pdf me-1"></i>
                                    Exportar PDF
                                </button>
                                <button class="btn btn-outline-success btn-sm" id="exportCsvBtn">
                                    <i class="bi bi-file-earmark-spreadsheet me-1"></i>
                                    Exportar CSV
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Results Modal -->
    <div class="modal fade" id="detailedResultsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Resultados Detalhados ETL</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="resultsTab">
                        <li class="nav-item">
                            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#summaryTab">Resumo</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#errorsTab">Erros</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#warningsTab">Avisos</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#metricsTab">Métricas</button>
                        </li>
                    </ul>
                    <div class="tab-content mt-3" id="resultsTabContent">
                        <div class="tab-pane fade show active" id="summaryTab">
                            <div id="summaryContent"></div>
                        </div>
                        <div class="tab-pane fade" id="errorsTab">
                            <div id="errorsContent"></div>
                        </div>
                        <div class="tab-pane fade" id="warningsTab">
                            <div id="warningsContent"></div>
                        </div>
                        <div class="tab-pane fade" id="metricsTab">
                            <div id="metricsContent"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- ETL Validator JS -->
    <script type="module" src="etl-validator-interface.js"></script>
</body>
</html>